# Secure Customer Service Portal API Specification

## Global Security Requirements

### Authentication Headers
All protected endpoints require:

Authorization: Bearer <jwt_token>
Content-Type: application/json


### JWT Token Structure
json
{
  "payload": {
    "userId": "string",
    "role": "enum(ADMIN, SALES_REP)",
    "iat": "number",
    "exp": "number"
  }
}


### Error Response Structure
json
{
  "status": "error",
  "code": "string",
  "message": "string",
  "details": "object?"
}


## Public Endpoints

### 1. POST /admin/login
Security: Public

Headers:
Content-Type: application/json

Request:
json
{
  "username": "string(required)",
  "password": "string(required, min: 8)",
  "deviceInfo": {
    "deviceId": "string",
    "platform": "string",
    "browser": "string"
  }
}

Response:
json
{
  "status": "success",
  "data": {
    "token": "string(jwt)",
    "refreshToken": "string",
    "adminId": "string",
    "username": "string",
    "role": "ADMIN",
    "permissions": ["string"],
    "expiresIn": "number(seconds)"
  }
}


### 2. POST /user/login
Security: Public

Headers:
Content-Type: application/json

Request:
json
{
  "username": "string(required)",
  "password": "string(required, min: 8)",
  "deviceInfo": {
    "deviceId": "string",
    "platform": "string",
    "browser": "string"
  }
}

Response:
json
{
  "status": "success",
  "data": {
    "token": "string(jwt)",
    "refreshToken": "string",
    "salesId": "string",
    "name": "string",
    "role": "SALES_REP",
    "permissions": ["string"],
    "expiresIn": "number(seconds)",
    "skillsScore": {
      "communication": "number(0-100)",
      "persuasion": "number(0-100)",
      "empathy": "number(0-100)"
    }
  }
}


## Protected Admin Endpoints

### 3. POST /admin/tasks/add-tasks
Security: Admin Only

Headers:
Authorization: Bearer <jwt_token>
Content-Type: multipart/form-data

Request:
json
{
  "title": "string(required, max: 200)",
  "description": "string(required, max: 1000)",
  "script": "string(optional)",
  "uniqueProposition": "string(required)",
  "generateScript": "boolean(default: false)",
  "assignedSalesReps": ["string(salesId)"],
  "priority": "enum(HIGH, MEDIUM, LOW)",
  "deadline": "ISO8601 datetime",
  "customersFile": "file(CSV, required)",
  "metadata": {
    "expectedCallDuration": "number(minutes)",
    "targetConversionRate": "number(percentage)",
    "requiredSkills": ["string"]
  }
}

Response:
json
{
  "status": "success",
  "data": {
    "taskId": "string",
    "title": "string",
    "createdAt": "ISO8601 datetime",
    "generatedScript": "string?",
    "assignedReps": [{
      "salesId": "string",
      "name": "string",
      "assignedCustomers": "number"
    }],
    "customerData": {
      "totalCustomers": "number",
      "validEntries": "number",
      "invalidEntries": [{
        "rowNumber": "number",
        "errors": ["string"]
      }]
    }
  }
}


### 4. GET /admin/dashboard/metrics
Security: Admin Only

Headers:
Authorization: Bearer <jwt_token>
Cache-Control: no-cache

Query Parameters:

startDate: ISO8601 datetime
endDate: ISO8601 datetime
timeZone: string(default: UTC)

Response:
json
{
  "status": "success",
  "data": {
    "overview": {
      "totalTasks": "number",
      "activeTasks": "number",
      "totalRepresentatives": "number",
      "activeRepresentatives": "number",
      "lastUpdated": "ISO8601 datetime"
    },
    "performance": {
      "callMetrics": {
        "totalCalls": "number",
        "totalDuration": "number(minutes)",
        "averageCallDuration": "number(minutes)",
        "successRate": "number(percentage)"
      },
      "customerMetrics": {
        "totalCustomers": "number",
        "contactedCustomers": "number",
        "successfulConversions": "number",
        "pendingFollowups": "number"
      },
      "sentimentAnalysis": {
        "positive": "number(percentage)",
        "neutral": "number(percentage)",
        "negative": "number(percentage)"
      }
    },
    "topPerformers": [{
      "salesId": "string",
      "name": "string",
      "metrics": {
        "callsCompleted": "number",
        "successRate": "number(percentage)",
        "averageDuration": "number(minutes)",
        "customerSatisfaction": "number(0-100)"
      }
    }]
  },
  "metadata": {
    "timeZone": "string",
    "period": {
      "start": "ISO8601 datetime",
      "end": "ISO8601 datetime"
    }
  }
}


## Protected Sales Representative Endpoints

### 5. GET /representative/:salesId/tasks
Security: Sales Rep (Only their own salesId) or Admin

Headers:
Authorization: Bearer <jwt_token>

Query Parameters:

status: enum(ALL, ACTIVE, COMPLETED, PENDING)
page: number(default: 1)
limit: number(default: 20)

Response:
json
{
  "status": "success",
  "data": {
    "activeTasks": [{
      "taskId": "string",
      "title": "string",
      "description": "string",
      "script": "string",
      "uniqueProposition": "string",
      "deadline": "ISO8601 datetime",
      "priority": "enum(HIGH, MEDIUM, LOW)",
      "progress": {
        "assigned": "number",
        "completed": "number",
        "pending": "number",
        "successRate": "number(percentage)"
      },
      "nextCustomer": {
        "customerId": "string",
        "name": "string",
        "priority": "enum(HIGH, MEDIUM, LOW)"
      }
    }],
    "pagination": {
      "currentPage": "number",
      "totalPages": "number",
      "totalItems": "number",
      "hasNext": "boolean"
    }
  }
}


### 6. POST /representative/call-completion
Security: Sales Rep or Admin

Headers:
Authorization: Bearer <jwt_token>
Content-Type: application/json

Request:
json
{
  "taskId": "string(required)",
  "salesId": "string(required)",
  "customerId": "string(required)",
  "callDetails": {
    "startTime": "ISO8601 datetime(required)",
    "endTime": "ISO8601 datetime(required)",
    "duration": "number(minutes, required)",
    "customerInsights": "string(required)",
    "sentiment": "enum(POSITIVE, NEUTRAL, NEGATIVE)",
    "outcome": "enum(SUCCESSFUL, NEEDS_FOLLOWUP, NOT_INTERESTED)",
    "nextFollowUpDate": "ISO8601 datetime?",
    "notes": "string",
    "recordedIssues": [{
      "type": "string",
      "description": "string",
      "severity": "enum(HIGH, MEDIUM, LOW)"
    }],
    "audioQuality": "enum(GOOD, AVERAGE, POOR)",
    "customerFeedback": {
      "rating": "number(1-5)?",
      "comments": "string?"
    }
  }
}

Response:
json
{
  "status": "success",
  "data": {
    "callId": "string",
    "duration": "number(minutes)",
    "nextActions": [{
      "type": "string",
      "description": "string",
      "deadline": "ISO8601 datetime"
    }],
    "performance": {
      "callQualityScore": "number(0-100)",
      "sentimentScore": "number(-1 to 1)",
      "suggestedImprovements": ["string"]
    }
  }
}


## WebSocket Endpoints (Real-time Updates)

### 7. WS /ws/representative-updates
Security: Authenticated WebSocket Connection

Connection Headers:
Authorization: Bearer <jwt_token>
Sec-WebSocket-Protocol: customer-service-portal


Message Types:
json
{
  "type": "TASK_UPDATE",
  "data": {
    "taskId": "string",
    "updateType": "enum(NEW_CUSTOMER, TASK_COMPLETED, PRIORITY_CHANGE)",
    "payload": "object"
  }
}

{
  "type": "PERFORMANCE_UPDATE",
  "data": {
    "salesId": "string",
    "metrics": {
      "callsToday": "number",
      "successRate": "number",
      "averageCallDuration": "number"
    }
  }
}


## Rate Limiting

All endpoints are rate-limited:
- Public endpoints: 60 requests per minute per IP
- Protected endpoints: 300 requests per minute per user
- WebSocket connections: 5 concurrent connections per user

Headers returned:

X-RateLimit-Limit: number
X-RateLimit-Remaining: number
X-RateLimit-Reset: timestamp


## Security Best Practices

1. *JWT Token Requirements:*
   - Algorithm: RS256
   - Expiration: 1 hour
   - Refresh Token Expiration: 7 days
   - Required Claims: sub, exp, iat, role

2. *Password Requirements:*
   - Minimum length: 8 characters
   - Must contain: uppercase, lowercase, number, special character
   - Bcrypt hashing with salt rounds: 12

3. *File Upload Restrictions:*
   - Max CSV size: 10MB
   - Allowed MIME types: text/csv
   - Max rows: 10,000

4. *Input Validation:*
   - All string inputs are trimmed and sanitized
   - SQL injection protection
   - XSS protection
   - Special character validation

5. *Audit Logging:*
   - All sensitive operations are logged
   - Log format includes: timestamp, userId, action, IP, userAgent
   - Logs are retained for 90 days

## Database Considerations

1. *Indexing Requirements:*
   - Compound index on (salesId, taskId)
   - Full-text search index on customer description
   - Index on call completion timestamps

2. *Data Retention:*
   - Call records: 2 years
   - Performance metrics: 5 years
   - Customer data: As per data protection laws